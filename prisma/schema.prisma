generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id                    String           @id @default(cuid())
  name                  String
  email                 String           @unique
  image                 String?
  passwordHash          String
  role                  Role             @default(USER)
  isBlocked             Boolean          @default(false)
  blockedAt             DateTime?
  blockedReason         String?
  isActive              Boolean          @default(true)
  deactivatedAt         DateTime?
  deactivatedReason     String?
  sessionVersion        Int              @default(0)
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  actionsPerformed      AdminActionLog[] @relation("AdminActionActor")
  actionsReceived       AdminActionLog[] @relation("AdminActionTarget")
}

enum Role {
  USER
  ADMIN
}

model AdminActionLog {
  id           String          @id @default(cuid())
  adminId      String
  targetUserId String
  action       AdminActionType
  reason       String?
  metadata     Json?
  createdAt    DateTime        @default(now())
  admin        User            @relation("AdminActionActor", fields: [adminId], references: [id], onDelete: Cascade)
  targetUser   User            @relation("AdminActionTarget", fields: [targetUserId], references: [id], onDelete: Cascade)

  @@index([targetUserId, createdAt(sort: Desc)])
  @@index([adminId, createdAt(sort: Desc)])
}

enum AdminActionType {
  BLOCK_USER
  UNBLOCK_USER
  CHANGE_DISPLAY_NAME
  REMOVE_PROFILE_PICTURE
  DEACTIVATE_USER
  REACTIVATE_USER
}
