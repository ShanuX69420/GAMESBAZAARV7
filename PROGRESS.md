# GamesBazaar Progress

## Done in this increment
- Created Next.js + TypeScript + Tailwind project in `gamesbazaar/`.
- Added SQLite database via Prisma.
- Added `User` model with role support (`USER`, `ADMIN`).
- Implemented Auth.js credentials authentication:
  - Register API (`/api/register`)
  - Login via NextAuth credentials provider
  - Logout button
  - Protected dashboard route (`/dashboard`)
- Replaced default landing page with GamesBazaar home page.
- Added `Admin Users v1`:
  - Admin dashboard hub (`/admin`) with user/moderation stats
  - Module cards: users, listings, orders
  - Admin-only route guard (`/admin`, `/admin/users`)
  - User search by ID/name/email
  - Block/unblock users
  - Change display name
  - Remove profile picture
  - Deactivate/reactivate user (soft delete)
  - Moderation audit logs with reasons/history
  - Session invalidation on moderation changes (force re-login)
  - Script to promote user to admin: `npm run make-admin -- <user-email>`
  - Placeholder routes for next modules:
    - `/admin/listings`
    - `/admin/orders`
- Added `Profile v1`:
  - User profile page (`/profile`)
  - Update display name
  - Add/remove profile picture upload with crop
  - Profile API endpoint (`/api/profile`)
  - Profile links in header and dashboard
  - Better login error messages for restricted accounts:
    - Deactivated account message
    - Blocked account message
- Added `Catalog + Listings v1`:
  - Prisma models:
    - `Category`
    - `Game`
    - `GameCategory` (allowed category mapping per game)
    - `GameOffering` (one per game+category with custom display label)
    - `Listing` with `ListingStatus`
  - Admin catalog module (`/admin/catalog`):
    - Create/delete categories
    - Create/delete games
    - Assign and update allowed categories per game
    - Auto-create offering labels for each selected game-category pair
    - Rename offering labels per category (e.g. `PUBG Mobile UC`)
    - Backend enforcement via `/api/admin/catalog` (admin-only)
  - Seller listings module:
    - My listings page (`/dashboard/listings`)
    - Create listing page (`/dashboard/listings/new`)
    - Listing create API (`/api/listings`)
    - Strict backend validation that listing uses valid game offering
- Added `Admin Listings Moderation v1`:
  - Listing status expansion:
    - `DRAFT`
    - `ACTIVE`
    - `PAUSED`
    - `HIDDEN_BY_ADMIN`
    - `REMOVED_BY_ADMIN`
  - Listing moderation fields:
    - `moderatedByAdminId`
    - `moderatedAt`
    - `moderationReason`
  - Listing moderation audit model:
    - `ListingModerationLog`
    - action, previous status, next status, reason, actor, timestamp
  - Admin listings module (`/admin/listings`):
    - Search by listing ID/title/seller/game/offering
    - Status filter
    - Moderation actions with mandatory reason:
      - hide
      - remove
      - restore
      - pause
      - unpause
    - Recent moderation history per listing
  - Admin listing moderation API:
    - `/api/admin/listings/[listingId]`
- Added `Search v2`:
  - Real-time header autocomplete search (desktop + mobile)
  - Suggestions include:
    - offering labels only (e.g. `8 Ball Pool Coins`, `PUBG Mobile UC`)
  - Search suggestions API: `/api/search/suggestions`
  - Removed generic game page; browsing now uses pair pages only (`/games/[gameId]/[categoryId]`)
  - Games search page now returns offering cards only (no standalone game cards)
  - Acronym matching support (e.g. `gta` -> `Grand Theft Auto`)
- Added `Game Icons v1`:
  - `Game.icon` field in Prisma
  - Admin can upload icon while creating game
  - Admin can replace/remove icon per game
  - Uploaded icons stored under `/public/uploads/games`
  - Game icons shown in:
    - realtime search suggestions
    - game-category search cards (`/games`)
    - game-category page header (`/games/[gameId]/[categoryId]`)
- Added `Format-Based Listings v1`:
  - Prisma updates:
    - `GameOffering.formatType` enum (`ACCOUNT`, `CURRENCY`)
    - `Listing.deliveryTimeText`
    - `Listing.formatData` JSON
  - Admin catalog updates:
    - Offering editor now supports both label and format type per offering
    - New offerings infer default format from category name (accounts/currency/boosting)
  - Seller listing creation updates:
    - Dynamic form by offering format
    - `ACCOUNT` form (title, price, delivery time, description)
    - `CURRENCY` form (title, unit label, price per unit, stock, min qty, delivery time, instructions)
  - Buyer game/offering page updates:
    - `ACCOUNT` layout: card/grid offers
    - `CURRENCY` layout: primary seller panel + other sellers list
    - Currency cards show per-unit price, stock, min qty, and delivery time
- Added `Currency Fixed Packages v1`:
  - `GameOffering.currencyMode` (`OPEN_QUANTITY`, `FIXED_PACKAGES`)
  - `GameOffering.currencyUnitLabel`
  - `OfferingPackageOption` model for admin-defined package amounts
  - `Listing.packageOptionId` for fixed package listings
  - Admin catalog:
    - Set currency mode per offering
    - Set unit label per offering
    - Add/remove fixed package amounts (e.g. `60`, `325`, `660` UC)
  - Seller listing creation:
    - Open Quantity mode: seller sets stock + min qty + price per unit
    - Fixed Packages mode: seller must pick admin package amount + set package price
  - Buyer offering page:
    - Fixed package amount cards with package switching
    - Primary seller box for selected package
    - Other sellers list for selected package
- Added `Demo Listing Seed v1`:
  - Script: `npm run seed:listings`
  - Creates demo sellers and credentials for quick UI testing
  - Seeds offerings and listings for:
    - Account listings
    - Currency open quantity listings
    - Currency fixed package listings (with package amount options)
  - Adds one hidden listing example for admin moderation view
- Added `Header Mega Menus v2`:
  - Desktop hover dropdown on all main header categories:
    - `Currency`
    - `Accounts`
    - `Top Ups`
    - `Items`
    - `Boosting`
  - Left panel: popular offerings for that hovered category
  - Right panel: searchable all offerings list for the hovered category
  - Right panel list is scrollable
  - All items link directly to offering pages (`/games/[gameId]/[categoryId]`)
- Added `Mobile Category Explorer v1`:
  - Mobile categories drawer now opens category detail views
  - Category detail includes:
    - search box
    - popular games list
    - all games list
  - Both lists link directly to offering pages
- Updated `Open Quantity Listing UI v2`:
  - Cleaner two-column layout for primary seller + checkout panel
  - Added interactive quantity selector (`-` / input / `+`)
  - Live total price update based on selected quantity
  - Improved "Other sellers" rows with stock/min qty/delivery/price columns
- Updated `Listing Title Rules v1`:
  - `ACCOUNT` listings still require manual title input
  - `CURRENCY` listings now auto-generate title server-side
  - Currency title input removed from seller listing form
- Updated `Delivery Presets + Instant v1`:
  - Listing form now uses fixed delivery time presets (no free text)
  - Backend now validates delivery preset keys strictly
  - Added `Instant delivery` option
  - `Instant delivery` is only allowed for Accounts/Gift Cards categories
  - Shared delivery-rule helpers added in `src/lib/listing-delivery.ts`

## Current routes
- `/` home
- `/login` login
- `/register` register
- `/dashboard` protected page
- `/dashboard/listings` seller listings
- `/dashboard/listings/new` create listing
- `/profile` user profile
- `/admin` admin dashboard
- `/admin/catalog` admin games/categories management
- `/admin/users` admin users management
- `/admin/listings` admin listings moderation
- `/admin/orders` admin orders placeholder
- `/api/auth/[...nextauth]` auth endpoints
- `/api/register` register endpoint
- `/api/profile` user profile update
- `/api/admin/users/[userId]` admin moderation actions
- `/api/admin/catalog` admin catalog actions
- `/api/admin/listings/[listingId]` admin listing moderation actions
- `/api/listings` listing creation
- `/api/search/suggestions` realtime game/category suggestions
- `/games/[gameId]/[categoryId]` game-category listing page

## Next suggested increment
- Orders + fake wallet flow:
  - wallet ledger + transaction model
  - buy flow with atomic balance update
  - buyer/seller order pages
  - admin orders moderation
