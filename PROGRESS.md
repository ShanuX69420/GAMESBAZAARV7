# GamesBazaar Progress

## Done in this increment
- Created Next.js + TypeScript + Tailwind project in `gamesbazaar/`.
- Added SQLite database via Prisma.
- Added `User` model with role support (`USER`, `ADMIN`).
- Implemented Auth.js credentials authentication:
  - Register API (`/api/register`)
  - Login via NextAuth credentials provider
  - Logout button
  - Protected dashboard route (`/dashboard`)
- Replaced default landing page with GamesBazaar home page.
- Added `Admin Users v1`:
  - Admin dashboard hub (`/admin`) with user/moderation stats
  - Module cards: users, listings, orders
  - Admin-only route guard (`/admin`, `/admin/users`)
  - User search by ID/name/email
  - Block/unblock users
  - Change display name
  - Remove profile picture
  - Deactivate/reactivate user (soft delete)
  - Moderation audit logs with reasons/history
  - Session invalidation on moderation changes (force re-login)
  - Script to promote user to admin: `npm run make-admin -- <user-email>`
  - Placeholder routes for next modules:
    - `/admin/listings`
    - `/admin/orders`
- Added `Profile v1`:
  - User profile page (`/profile`)
  - Update display name
  - Add/remove profile picture upload with crop
  - Profile API endpoint (`/api/profile`)
  - Profile links in header and dashboard
  - Better login error messages for restricted accounts:
    - Deactivated account message
    - Blocked account message
- Added `Catalog + Listings v1`:
  - Prisma models:
    - `Category`
    - `Game`
    - `GameCategory` (allowed category mapping per game)
    - `GameOffering` (one per game+category with custom display label)
    - `Listing` with `ListingStatus`
  - Admin catalog module (`/admin/catalog`):
    - Create/delete categories
    - Create/delete games
    - Assign and update allowed categories per game
    - Auto-create offering labels for each selected game-category pair
    - Rename offering labels per category (e.g. `PUBG Mobile UC`)
    - Backend enforcement via `/api/admin/catalog` (admin-only)
  - Seller listings module:
    - My listings page (`/dashboard/listings`)
    - Create listing page (`/dashboard/listings/new`)
    - Listing create API (`/api/listings`)
    - Strict backend validation that listing uses valid game offering
- Added `Admin Listings Moderation v1`:
  - Listing status expansion:
    - `DRAFT`
    - `ACTIVE`
    - `PAUSED`
    - `HIDDEN_BY_ADMIN`
    - `REMOVED_BY_ADMIN`
  - Listing moderation fields:
    - `moderatedByAdminId`
    - `moderatedAt`
    - `moderationReason`
  - Listing moderation audit model:
    - `ListingModerationLog`
    - action, previous status, next status, reason, actor, timestamp
  - Admin listings module (`/admin/listings`):
    - Search by listing ID/title/seller/game/offering
    - Status filter
    - Moderation actions with mandatory reason:
      - hide
      - remove
      - restore
      - pause
      - unpause
    - Recent moderation history per listing
  - Admin listing moderation API:
    - `/api/admin/listings/[listingId]`
- Added `Search v2`:
  - Real-time header autocomplete search (desktop + mobile)
  - Suggestions include:
    - offering labels only (e.g. `8 Ball Pool Coins`, `PUBG Mobile UC`)
  - Search suggestions API: `/api/search/suggestions`
  - Removed generic game page; browsing now uses pair pages only (`/games/[gameId]/[categoryId]`)
  - Games search page now returns offering cards only (no standalone game cards)
  - Acronym matching support (e.g. `gta` -> `Grand Theft Auto`)
- Added `Game Icons v1`:
  - `Game.icon` field in Prisma
  - Admin can upload icon while creating game
  - Admin can replace/remove icon per game
  - Uploaded icons stored under `/public/uploads/games`
  - Game icons shown in:
    - realtime search suggestions
    - game-category search cards (`/games`)
    - game-category page header (`/games/[gameId]/[categoryId]`)

## Current routes
- `/` home
- `/login` login
- `/register` register
- `/dashboard` protected page
- `/dashboard/listings` seller listings
- `/dashboard/listings/new` create listing
- `/profile` user profile
- `/admin` admin dashboard
- `/admin/catalog` admin games/categories management
- `/admin/users` admin users management
- `/admin/listings` admin listings placeholder
- `/admin/orders` admin orders placeholder
- `/api/auth/[...nextauth]` auth endpoints
- `/api/register` register endpoint
- `/api/profile` user profile update
- `/api/admin/users/[userId]` admin moderation actions
- `/api/admin/catalog` admin catalog actions
- `/api/admin/listings/[listingId]` admin listing moderation actions
- `/api/listings` listing creation
- `/api/search/suggestions` realtime game/category suggestions
- `/games/[gameId]/[categoryId]` game-category listing page

## Next suggested increment
- Orders + fake wallet flow:
  - wallet ledger + transaction model
  - buy flow with atomic balance update
  - buyer/seller order pages
  - admin orders moderation
